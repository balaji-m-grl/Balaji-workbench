# Question 3

## User Question

Add PD 3.1 / EPR extensions

* * *

## Assistant Answer

Perfect, this is where the schema becomes **future-proof and genuinely differentiating**. I’ll extend the earlier schema **without breaking compatibility**, and I’ll call out _why_ each addition exists from an agent-reasoning point of view.

* * *

## 1. What PD 3.1 / EPR adds (schema perspective)

PD 3.1 introduces **Extended Power Range (EPR)** with new concepts the model must reason about:

* New voltage levels: **28V, 36V, 48V**
    
* **AVS (Adjustable Voltage Supply)** instead of PPS
    
* **EPR mode entry / exit handshake**
    
* Stricter **cable requirements** (50V / 5A)
    
* New **timing and safety constraints**
    
* **EPR-specific fault classes**
    

So the schema must explicitly encode:

> _“Is EPR even allowed here?”_

* * *

## 2. Schema extension strategy

We extend via **optional blocks**, not replacements:

```
capabilities
├── source_pdos
├── sink_constraints
└── epr_capabilities   (NEW)

protocol_trace
└── epr_messages       (NEW)

electrical_trace
└── epr_vbus_profile   (NEW)

timing_profile
└── epr_timing         (NEW)

fault_injection
└── epr_faults         (NEW)

expected_outcome
└── epr_compliance     (NEW)
```

Legacy PD agents can ignore these safely.

* * *

## 3. EPR capability declaration

### 3.1 Source & sink EPR capabilities

```json
"epr_capabilities": {
  "epr_supported": true,
  "source": {
    "max_voltage_v": 48,
    "max_current_a": 5,
    "avs_supported": true
  },
  "sink": {
    "max_voltage_v": 36,
    "max_current_a": 5,
    "avs_supported": true
  }
}
```

Why this matters:

* Prevents invalid EPR reasoning
    
* Agent can immediately answer:  
    **“EPR negotiation should not have happened”**
    

* * *

## 4. Cable extensions (critical for PD 3.1)

```json
"topology": {
  "cable": {
    "e_marker": true,
    "current_capability_a": 5,
    "voltage_rating_v": 50,
    "epr_certified": true
  }
}
```

Agent rule:

> EPR = **5A + 50V + e-marker**, or fail fast.

* * *

## 5. EPR protocol messages

### 5.1 EPR entry handshake

```json
"epr_messages": [
  {
    "seq": 10,
    "timestamp_ms": 600,
    "sender": "SOURCE",
    "message": "EPR_MODE_ENTRY"
  },
  {
    "seq": 11,
    "timestamp_ms": 620,
    "sender": "SINK",
    "message": "EPR_MODE_ACK"
  }
]
```

Key:

* Separate from normal PD messages
    
* Allows agent to reason about **mode transitions**
    

* * *

## 6. AVS PDOs (EPR-specific)

```json
"capabilities": {
  "source_pdos": [
    {
      "type": "AVS",
      "min_voltage_v": 15,
      "max_voltage_v": 48,
      "max_current_a": 5,
      "step_size_mv": 100
    }
  ]
}
```

Agent can now:

* Validate step size
    
* Validate voltage request granularity
    

* * *

## 7. EPR electrical profile

```json
"epr_vbus_profile": {
  "requested_voltage_v": 36,
  "actual_voltage_v": 36.5,
  "ramp_time_ms": 450,
  "overshoot_v": 38.2,
  "steady_state_ripple_mv": 120
}
```

Why separate from SPR:

* Different safety limits
    
* Different failure interpretation
    

* * *

## 8. EPR timing constraints

```json
"epr_timing": {
  "t_epr_entry_max_ms": 700,
  "t_epr_source_ready_ms": 450,
  "t_epr_exit_ms": 300
}
```

Agent comparison logic:

* EPR timings ≠ SPR timings
    
* Violations are **more severe**
    

* * *

## 9. EPR-specific fault injection

```json
"epr_faults": [
  {
    "type": "EPR_UNSUPPORTED_CABLE",
    "description": "Cable not rated for 50V operation"
  },
  {
    "type": "EPR_OVERVOLTAGE",
    "measured_v": 38.2,
    "allowed_max_v": 37
  }
]
```

These faults are **unique to PD 3.1** and must not be mixed with PD 3.0 errors.

* * *

## 10. Expected outcome with EPR compliance

```json
"expected_outcome": {
  "result": "FAIL",
  "error_category": "EPR_SAFETY",
  "root_cause": "EPR overvoltage during AVS transition",
  "epr_compliance": {
    "epr_entry": "PASS",
    "avs_regulation": "FAIL",
    "cable_check": "PASS"
  },
  "recommended_action": [
    "Tighten AVS voltage control loop",
    "Re-validate EPR safety margins"
  ]
}
```

This is **perfect supervision data**.

* * *

## 11. What an agent can now reason about

With these extensions, the agent can answer:

* “Should EPR have been attempted?”
    
* “Is this a cable, policy, or electrical issue?”
    
* “Is this PD 3.0 behavior incorrectly reused in PD 3.1?”
    
* “Is this a safety-critical violation?”
    

That’s **expert-level reasoning**, not pattern matching.

* * *

### My opinion

PD 3.1 / EPR is exactly where **synthetic data beats real logs**. Real EPR failures are rare, risky, and expensive to reproduce. Encoding them synthetically lets you train agents that _understand power safety_, not just messages.

If you want next, we can:

* Design an **EPR scenario generator**
    
* Define **EPR safety scoring**
    
* Map this schema to **regulatory / certification test cases**
    
* Or compress this into a **context-efficient agent input format**

* * *

## Suggested / Follow-up Questions

- Q3.1 What specific EPR concepts must the model reason about in PD 3.1 / EPR?
- Q3.2 Can you provide an example of how to extend the schema without breaking compatibility for PD 3.1/EPR?
- Q3.3 How are the new cables specified in the schema for PD 3.1/EPR?
- Q3.4 Why is it important for agents to explicitly encode 'Is EPR even allowed here?'
- Q3.5 What additional messages does PD 3.1 / EPR introduce in terms of protocol messages?
- Q3.6 Does adding these new capabilities affect compatibility with older models or must they be ignored by legacy PD agents?
